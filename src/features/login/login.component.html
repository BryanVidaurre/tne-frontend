<div class="login-shell">
  <mat-card class="login-card" appearance="outlined">
    <mat-card-header>
      <mat-card-title>Portal TNE</mat-card-title>
      <mat-card-subtitle>Acceso administrativo y consulta pública</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <mat-tab-group>
        <mat-tab label="Ingresar">
          <form class="tab-body" (ngSubmit)="onLogin()">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Usuario</mat-label>
              <input matInput [(ngModel)]="user" name="user" autocomplete="username" />
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Contraseña</mat-label>
              <input
                matInput
                type="password"
                [(ngModel)]="pass"
                name="pass"
                autocomplete="current-password"
              />
            </mat-form-field>

            <div *ngIf="loginError" class="msg msg-error">{{ loginError }}</div>

            <button mat-raised-button color="primary" type="submit" [disabled]="loginBusy">
              <mat-spinner *ngIf="loginBusy" diameter="18"></mat-spinner>
              <span>{{ loginBusy ? 'Ingresando...' : 'Ingresar' }}</span>
            </button>
          </form>
        </mat-tab>

        <mat-tab label="Consultar por RUT">
          <form class="tab-body" (ngSubmit)="onPublicQuery()">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>RUT</mat-label>
              <input matInput [(ngModel)]="rut" name="rut" placeholder="Ej: 12345678-9" />
            </mat-form-field>

            <div *ngIf="publicError" class="msg msg-error">{{ publicError }}</div>

            <button mat-raised-button color="primary" type="submit" [disabled]="publicBusy">
              <mat-spinner *ngIf="publicBusy" diameter="18"></mat-spinner>
              <span>{{ publicBusy ? 'Consultando...' : 'Consultar' }}</span>
            </button>
          </form>

          <div *ngIf="publicData" class="public-result">
            <div class="public-meta">
              <div class="label">Última actualización</div>
              <div class="value">{{ publicData.updated_at || '-' }}</div>
            </div>
            <div class="public-message" [innerHTML]="publicData.mensaje_html || ''"></div>
          </div>
        </mat-tab>
      </mat-tab-group>
    </mat-card-content>
  </mat-card>
</div>
